<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PGSoft Admin</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #0f172a;
      color: #e2e8f0;
      font-family: Arial, sans-serif;
      margin: 0;
    }

    .glass {
      background: rgba(30, 41, 59, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script>
    var useState = React.useState;
    var useEffect = React.useEffect;
    var e = React.createElement;
    var API = window.location.origin;

    function App() {
      var tabState = useState('agents');
      var tab = tabState[0];
      var setTab = tabState[1];

      return e('div', { style: { display: 'flex', minHeight: '100vh' } },
        e('div', { style: { width: '250px', background: '#1e293b', borderRight: '1px solid #334155', padding: '20px' } },
          e('h1', { style: { color: '#3b82f6', fontSize: '24px', marginBottom: '30px' } }, 'PGSoft Admin'),
          e('button', {
            onClick: function () { setTab('agents'); },
            style: {
              width: '100%', padding: '12px', marginBottom: '10px',
              background: tab === 'agents' ? '#3b82f6' : '#334155',
              color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer'
            }
          }, 'Agentes'),
          e('button', {
            onClick: function () { setTab('users'); },
            style: {
              width: '100%', padding: '12px',
              background: tab === 'users' ? '#3b82f6' : '#334155',
              color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer'
            }
          }, 'Usuários')
        ),
        e('div', { style: { flex: 1, padding: '40px', background: '#020617' } },
          tab === 'agents' ? e(AgentsList) : e(UsersList)
        )
      );
    }

    function AgentsList() {
      var agentsState = useState([]);
      var agents = agentsState[0];
      var setAgents = agentsState[1];

      var loadingState = useState(true);
      var loading = loadingState[0];
      var setLoading = loadingState[1];

      var modalState = useState(false);
      var modal = modalState[0];
      var setModal = modalState[1];

      var codeState = useState('');
      var code = codeState[0];
      var setCode = codeState[1];

      var saldoState = useState('');
      var saldo = saldoState[0];
      var setSaldo = saldoState[1];

      useEffect(function () {
        fetch(API + '/api/v1/agents')
          .then(function (res) { return res.json(); })
          .then(function (data) {
            if (data.status === 'success') setAgents(data.data);
            setLoading(false);
          })
          .catch(function () { setLoading(false); });
      }, []);

      function createAgent(ev) {
        ev.preventDefault();
        fetch(API + '/api/v1/createagent', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ agent_code: code, saldo: parseFloat(saldo) })
        })
          .then(function (res) { return res.json(); })
          .then(function (result) {
            if (result.status === 'success') {
              alert('Agente criado!\nToken: ' + result.agentToken + '\nSecret: ' + result.secretKey);
              window.location.reload();
            } else {
              alert('Erro: ' + (result.message || 'Desconhecido'));
            }
          })
          .catch(function () { alert('Erro de conexão'); });
      }

      return e('div', null,
        e('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '30px' } },
          e('h2', { style: { fontSize: '32px', fontWeight: 'bold' } }, 'Agentes'),
          e('button', {
            onClick: function () { setModal(true); },
            style: {
              background: '#16a34a', color: 'white', padding: '12px 24px',
              border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 'bold'
            }
          }, '+ Novo Agente')
        ),

        loading ? e('p', null, 'Carregando...') :
          e('table', { style: { width: '100%', background: 'rgba(30, 41, 59, 0.7)', borderRadius: '12px', overflow: 'hidden' } },
            e('thead', { style: { background: '#1e293b' } },
              e('tr', null,
                e('th', { style: { padding: '16px', textAlign: 'left' } }, 'ID'),
                e('th', { style: { padding: '16px', textAlign: 'left' } }, 'Código'),
                e('th', { style: { padding: '16px', textAlign: 'left' } }, 'Saldo')
              )
            ),
            e('tbody', null,
              agents.map(function (agent) {
                return e('tr', { key: agent.id, style: { borderBottom: '1px solid #334155' } },
                  e('td', { style: { padding: '16px' } }, agent.id),
                  e('td', { style: { padding: '16px', fontWeight: 'bold' } }, agent.agentCode),
                  e('td', { style: { padding: '16px', color: '#4ade80' } }, 'R$ ' + agent.saldo)
                );
              })
            )
          ),

        modal ? e('div', {
          style: {
            position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
            background: 'rgba(0,0,0,0.7)', display: 'flex', alignItems: 'center', justifyContent: 'center'
          },
          onClick: function () { setModal(false); }
        },
          e('div', {
            style: {
              background: '#1e293b', padding: '30px', borderRadius: '12px',
              width: '500px', maxWidth: '90%'
            },
            onClick: function (ev) { ev.stopPropagation(); }
          },
            e('h3', { style: { fontSize: '24px', marginBottom: '20px' } }, 'Novo Agente'),
            e('form', { onSubmit: createAgent },
              e('input', {
                placeholder: 'Código do Agente',
                value: code,
                onChange: function (ev) { setCode(ev.target.value); },
                required: true,
                style: {
                  width: '100%', padding: '12px', marginBottom: '15px',
                  background: '#0f172a', border: '1px solid #334155',
                  borderRadius: '8px', color: 'white'
                }
              }),
              e('input', {
                type: 'number',
                placeholder: 'Saldo Inicial',
                value: saldo,
                onChange: function (ev) { setSaldo(ev.target.value); },
                required: true,
                style: {
                  width: '100%', padding: '12px', marginBottom: '20px',
                  background: '#0f172a', border: '1px solid #334155',
                  borderRadius: '8px', color: 'white'
                }
              }),
              e('button', {
                type: 'submit',
                style: {
                  width: '100%', padding: '12px', background: '#16a34a',
                  color: 'white', border: 'none', borderRadius: '8px',
                  cursor: 'pointer', fontWeight: 'bold'
                }
              }, 'Criar Agente')
            )
          )
        ) : null
      );
    }

    function UsersList() {
      var usersState = useState([]);
      var users = usersState[0];
      var setUsers = usersState[1];

      var loadingState = useState(true);
      var loading = loadingState[0];
      var setLoading = loadingState[1];

      useEffect(function () {
        fetch(API + '/api/v1/users')
          .then(function (res) { return res.json(); })
          .then(function (data) {
            if (data.status === 'success') setUsers(data.data);
            setLoading(false);
          })
          .catch(function () { setLoading(false); });
      }, []);

      return e('div', null,
        e('h2', { style: { fontSize: '32px', fontWeight: 'bold', marginBottom: '30px' } }, 'Usuários'),
        loading ? e('p', null, 'Carregando...') :
          e('table', { style: { width: '100%', background: 'rgba(30, 41, 59, 0.7)', borderRadius: '12px', overflow: 'hidden' } },
            e('thead', { style: { background: '#1e293b' } },
              e('tr', null,
                e('th', { style: { padding: '16px', textAlign: 'left' } }, 'ID'),
                e('th', { style: { padding: '16px', textAlign: 'left' } }, 'Username'),
                e('th', { style: { padding: '16px', textAlign: 'left' } }, 'Saldo')
              )
            ),
            e('tbody', null,
              users.map(function (user) {
                return e('tr', { key: user.id, style: { borderBottom: '1px solid #334155' } },
                  e('td', { style: { padding: '16px' } }, user.id),
                  e('td', { style: { padding: '16px' } }, user.username),
                  e('td', { style: { padding: '16px', color: '#4ade80' } }, 'R$ ' + user.saldo)
                );
              })
            )
          )
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(e(App));
  </script>
</body>

</html>