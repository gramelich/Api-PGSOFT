<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PGSoft API Debug Dashboard</title>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #0f172a;
      color: #e2e8f0;
      font-family: 'Inter', sans-serif;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div id="root" class="min-h-screen flex items-center justify-center"></div>

  <script type="text/javascript">
    const { useState, useEffect } = React;
    // Use relative URL if on same domain, or fallback to current origin
    const API_BASE_URL = window.location.origin;

    function PGSoftDashboard() {
      const [games] = useState([
        { id: "fortune-tiger", name: "Fortune Tiger", icon: "üêØ" },
        { id: "fortune-rabbit", name: "Fortune Rabbit", icon: "üê∞" },
        { id: "fortune-ox", name: "Fortune Ox", icon: "üêÇ" },
        { id: "fortune-mouse", name: "Fortune Mouse", icon: "üê≠" },
        { id: "ganesha-gold", name: "Ganesha Gold", icon: "üêò" },
        { id: "bikine-paradise", name: "Bikini Paradise", icon: "üèñÔ∏è" },
        { id: "fortune-dragon", name: "Dragon Hatch", icon: "üêâ" },
        { id: "dragon-tiger-luck", name: "Mahjong Ways 2", icon: "üÄÑ" },
      ]);

      const [selectedGame, setSelectedGame] = useState(null);
      const [logs, setLogs] = useState([]);
      const [loading, setLoading] = useState(false);
      
      // Admin State
      const [agentToken, setAgentToken] = useState("");
      const [secretKey, setSecretKey] = useState("");
      const [userCode, setUserCode] = useState("test_user_01");
      const [userBalance, setUserBalance] = useState(1000);
      const [launchUrl, setLaunchUrl] = useState("");
      const [createdAgent, setCreatedAgent] = useState(null);

      const log = (msg, data = null) => {
        console.log(msg, data || "");
        setLogs(prev => [
          { time: new Date().toLocaleTimeString(), msg, data },
          ...prev,
        ]);
      };

      const makeAPICall = async (endpoint, method = "POST", body = null) => {
        const url = API_BASE_URL + endpoint;
        setLoading(true);
        const start = Date.now();
        log(`‚û°Ô∏è Chamando ${method} ${url}`, body);

        try {
          const response = await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: body ? JSON.stringify(body) : undefined,
          });

          const elapsed = Date.now() - start;
          const text = await response.text();
          let parsed;
          try {
            parsed = JSON.parse(text);
          } catch {
            parsed = text;
          }

          log(`‚úÖ Resposta (${response.status}) em ${elapsed}ms`, parsed);
          return parsed;
        } catch (error) {
          log(`‚ùå Erro na requisi√ß√£o: ${error.message}`);
          return null;
        } finally {
          setLoading(false);
        }
      };

      const handleCreateAgent = async () => {
        const res = await makeAPICall("/api/v1/createagent", "POST", {
            agent_code: "admin_agent",
            saldo: 10000
        });
        if (res && res.status === "success") {
            setAgentToken(res.agentToken);
            setSecretKey(res.secretKey);
            setCreatedAgent(res);
            alert("Agent criado com sucesso! Token e Secret preenchidos.");
        }
      };

      const handleLaunchGame = async (gameId) => {
        if (!agentToken || !secretKey) {
            alert("Crie um Agent primeiro!");
            return;
        }
        const res = await makeAPICall("/api/v1/game_launch", "POST", {
            agentToken,
            secretKey,
            user_code: userCode,
            game_code: gameId,
            user_balance: Number(userBalance),
            game_type: "slot",
            provider_code: "PGSOFT"
        });

        if (res && res.status === 1) {
            setLaunchUrl(res.launch_url);
            // Open in new tab?
            // window.open(res.launch_url, "_blank");
        }
      };

      const handleGameInfo = (g) => {
        setSelectedGame(g);
        // Usually GameInfo requires a token from the launch, but here we are just debugging endpoints
        // If you want to simulate a game spin, you need a valid 'atk' (token) from the launch response.
        // For now, we will just call it to see if it responds 404 or 200 (even if error).
        makeAPICall(`/game-api/${g.id}/v2/GameInfo/Get`, "POST", { atk: "test-token" });
      };

      const handleSpin = (g) => {
         makeAPICall(`/game-api/${g.id}/v2/Spin`, "POST", { 
             atk: "test-token",
             cs: 0.1,
             ml: 1
         });
      };

      return React.createElement(
        "div",
        { className: "p-6 max-w-6xl w-full mx-auto" },
        React.createElement(
          "h1",
          { className: "text-3xl font-bold mb-8 text-center text-blue-400" },
          "üé∞ PGSoft API Admin & Debug"
        ),

        // --- Admin Section ---
        React.createElement("div", { className: "bg-slate-800 p-6 rounded-xl mb-8 border border-slate-700" },
            React.createElement("h2", { className: "text-xl font-bold mb-4 text-white" }, "üõ†Ô∏è Administra√ß√£o"),
            
            // Create Agent
            React.createElement("div", { className: "mb-6 pb-6 border-b border-slate-700" },
                React.createElement("button", {
                    onClick: handleCreateAgent,
                    className: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition font-bold"
                }, "1. Criar Novo Agent"),
                createdAgent && React.createElement("div", { className: "mt-2 text-green-400 text-sm" }, 
                    `Agent Criado! Token: ${createdAgent.agentToken.slice(0,10)}...`
                )
            ),

            // Launch Config
            React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-4" },
                React.createElement("div", null,
                    React.createElement("label", { className: "block text-xs text-slate-400 mb-1" }, "Agent Token"),
                    React.createElement("input", { 
                        className: "w-full bg-slate-900 border border-slate-600 rounded p-2 text-white",
                        value: agentToken,
                        onChange: e => setAgentToken(e.target.value),
                        placeholder: "Gere um agent primeiro"
                    })
                ),
                React.createElement("div", null,
                    React.createElement("label", { className: "block text-xs text-slate-400 mb-1" }, "Secret Key"),
                    React.createElement("input", { 
                        className: "w-full bg-slate-900 border border-slate-600 rounded p-2 text-white",
                        value: secretKey,
                        onChange: e => setSecretKey(e.target.value),
                        placeholder: "Gere um agent primeiro"
                    })
                ),
                React.createElement("div", null,
                    React.createElement("label", { className: "block text-xs text-slate-400 mb-1" }, "User Code"),
                    React.createElement("input", { 
                        className: "w-full bg-slate-900 border border-slate-600 rounded p-2 text-white",
                        value: userCode,
                        onChange: e => setUserCode(e.target.value)
                    })
                ),
                React.createElement("div", null,
                    React.createElement("label", { className: "block text-xs text-slate-400 mb-1" }, "Saldo Inicial"),
                    React.createElement("input", { 
                        type: "number",
                        className: "w-full bg-slate-900 border border-slate-600 rounded p-2 text-white",
                        value: userBalance,
                        onChange: e => setUserBalance(e.target.value)
                    })
                )
            )
        ),

        // --- Games Section ---
        React.createElement(
          "div",
          { className: "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 mb-6" },
          games.map((g) =>
            React.createElement(
              "button",
              {
                key: g.id,
                className: `p-4 rounded-xl border border-slate-600 hover:bg-slate-700 transition flex flex-col items-center gap-2 ${
                  selectedGame && selectedGame.id === g.id ? "bg-slate-700 border-blue-500" : ""
                }`,
                onClick: () => {
                    setSelectedGame(g);
                    handleLaunchGame(g.id);
                },
              },
              React.createElement("div", { className: "text-4xl" }, g.icon),
              React.createElement("div", { className: "text-xs font-bold text-center" }, g.name)
            )
          )
        ),

        // --- Launch Result ---
        launchUrl && React.createElement("div", { className: "bg-green-900/30 border border-green-500 p-4 rounded-lg mb-6 text-center" },
            React.createElement("p", { className: "mb-2 text-green-300 font-bold" }, "Jogo Lan√ßado com Sucesso!"),
            React.createElement("a", { 
                href: launchUrl, 
                target: "_blank",
                className: "inline-block bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-full font-bold shadow-lg transform hover:scale-105 transition"
            }, "‚ñ∂Ô∏è JOGAR AGORA")
        ),

        loading &&
          React.createElement(
            "div",
            { className: "text-yellow-400 text-center mb-3 font-mono animate-pulse" },
            "‚è≥ Processando..."
          ),

        // --- Logs ---
        React.createElement(
          "div",
          {
            className:
              "bg-slate-900 rounded-lg p-4 max-h-[300px] overflow-auto text-xs font-mono border border-slate-800",
          },
          logs.length === 0
            ? React.createElement("span", { className: "text-slate-600" }, "Logs do sistema aparecer√£o aqui...")
            : logs.map((l, i) =>
                React.createElement(
                  "div",
                  { key: i, className: "mb-2 border-b border-slate-800 pb-1 last:border-0" },
                  React.createElement(
                    "span",
                    { className: "text-slate-500 mr-2" },
                    `[${l.time}]`
                  ),
                  React.createElement("span", { className: l.msg.includes("‚ùå") ? "text-red-400" : "text-blue-300" }, l.msg),
                  l.data &&
                    React.createElement(
                      "pre",
                      { className: "text-slate-400 mt-1 pl-4 border-l-2 border-slate-700" },
                      typeof l.data === "string"
                        ? l.data
                        : JSON.stringify(l.data, null, 2)
                    )
                )
              )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(
      React.createElement(PGSoftDashboard)
    );
  </script>
</body>
</html>
